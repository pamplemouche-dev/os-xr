<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Gemini OS - Micro Live</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; touch-action: none; }
        #boot-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, #1a237e 0%, #000 100%);
            display: flex; justify-content: center; align-items: center;
            z-index: 10000; color: #fff; font-family: sans-serif; cursor: pointer;
        }
    </style>
</head>
<body>

    <div id="boot-screen" onclick="unlockAudio()">
        <h1 id="status-text">CLIQUEZ POUR INITIALISER</h1>
    </div>

    <a-scene vr-mode-ui="enabled: false" cursor="rayOrigin: mouse">
        <a-sky color="#02050a"></a-sky>
        
        <a-entity id="rig">
            <a-camera id="main-cam" look-controls="enabled: false">
                <a-cursor color="#8ab4f8" raycaster="objects: .clickable"></a-cursor>
            </a-camera>
        </a-entity>

        <a-entity id="main-menu" visible="false" position="0 1.5 -2.5">
            <a-circle class="clickable" radius="0.4" color="#4285f4" onclick="startGeminiVoice()">
                <a-text value="PARLER A GEMINI" align="center" position="0 0 0.1" width="3.5"></a-text>
            </a-circle>
        </a-entity>

        <a-entity id="gemini-view" visible="false" position="0 1.5 -3">
            <a-sphere id="orb" radius="0.3" color="#8ab4f8"></a-sphere>
            
            <a-plane width="3" height="1.2" position="0 1 0" color="#111">
                <a-text id="output" value="En attente du micro..." align="center" width="2.5"></a-text>
            </a-plane>

            <a-box class="clickable" position="0 -1 0" width="1" height="0.4" depth="0.1" color="#333" onclick="resetOS()">
                <a-text value="QUITTER" align="center" width="3"></a-text>
            </a-box>
        </a-entity>
    </a-scene>

    <script>
        const cam = document.getElementById('main-cam');
        const boot = document.getElementById('boot-screen');
        const menu = document.getElementById('main-menu');
        const view = document.getElementById('gemini-view');
        const output = document.getElementById('output');
        const orb = document.getElementById('orb');

        // Système de rotation tactile (Axe Y débloqué)
        let pitch = 0, yaw = 0, lastX = 0, lastY = 0;
        window.addEventListener('touchstart', e => { lastX = e.touches[0].clientX; lastY = e.touches[0].clientY; });
        window.addEventListener('touchmove', e => {
            let dx = e.touches[0].clientX - lastX;
            let dy = e.touches[0].clientY - lastY;
            lastX = e.touches[0].clientX; lastY = e.touches[0].clientY;
            yaw -= dx * 0.3; pitch -= dy * 0.3;
            pitch = Math.max(-90, Math.min(90, pitch));
            cam.setAttribute('rotation', `${pitch} ${yaw} 0`);
        });

        function unlockAudio() {
            window.speechSynthesis.speak(new SpeechSynthesisUtterance(""));
            boot.style.display = 'none';
            menu.setAttribute('visible', 'true');
        }

        function speak(text) {
            let utter = new SpeechSynthesisUtterance(text);
            utter.lang = 'fr-FR';
            window.speechSynthesis.speak(utter);
        }

        function startGeminiVoice() {
            menu.setAttribute('visible', 'false');
            view.setAttribute('visible', 'true');
            
            // Initialisation de la reconnaissance vocale
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            
            if (!SpeechRecognition) {
                output.setAttribute('value', "Erreur: Micro non supporté sur ce navigateur.");
                return;
            }

            const recognition = new SpeechRecognition();
            recognition.lang = 'fr-FR';
            recognition.interimResults = false;

            recognition.onstart = () => {
                output.setAttribute('value', "Gemini vous écoute...");
                orb.setAttribute('color', '#ff4444'); // Rouge quand il écoute
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                output.setAttribute('value', "Vous: " + transcript);
                orb.setAttribute('color', '#4285f4'); // Bleu quand il réfléchit
                
                // Simulation de réponse Gemini
                setTimeout(() => {
                    const response = "J'ai bien entendu : " + transcript + ". Comment puis-je vous aider davantage ?";
                    output.setAttribute('value', "Gemini: " + response);
                    speak(response);
                }, 1000);
            };

            recognition.onerror = (event) => {
                output.setAttribute('value', "Erreur micro: " + event.error);
                orb.setAttribute('color', '#8ab4f8');
            };

            recognition.start();
        }

        function resetOS() {
            view.setAttribute('visible', 'false');
            menu.setAttribute('visible', 'true');
            window.speechSynthesis.cancel();
        }
    </script>
</body>
</html>
